<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"       
       xmlns:jee="http://www.springframework.org/schema/jee"       
       xmlns:aop="http://www.springframework.org/schema/aop"     
       xmlns:tx="http://www.springframework.org/schema/tx"       
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="
            http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
            http://www.springframework.org/schema/context 
            http://www.springframework.org/schema/context/spring-context-3.1.xsd
            http://www.springframework.org/schema/jee 
            http://www.springframework.org/schema/jee/spring-jee-3.1.xsd
            http://www.springframework.org/schema/aop 
            http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
            http://www.springframework.org/schema/tx
            http://www.springframework.org/schema/tx/spring-tx-3.1.xsd
            http://www.springframework.org/schema/security
            http://www.springframework.org/schema/security/spring-security-3.1.xsd ">
           


    

    <jee:jndi-lookup id="dsApp" jndi-name="jdbc/Atfsff"/>
    
    
    <!-- config transactions -->
    <tx:annotation-driven />    
    
    <!-- TRANSACTION MANAGER ................................... -->
        <!-- transaction for non-JavaEE -->
        <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
            <property name="dataSource" ref="dsApp"/>
        </bean> 
        <!--
        <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
            <property name="entityManagerFactory" ref="myEmf" />
        </bean>  -->       
        
        <!-- .................................. -->
        <!-- transaction for JavaEE container -->
        <!--
            <tx:jta-transaction-manager/>     
        -->

        
 <!--M      
    <bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor" /> -->                        
    
    
    <!-- jpa -->
   <!--M <bean id="myEmf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
        <property name="dataSource" ref="dsApp"/>      
        <property name="persistenceUnitName" value="Abm-PU"/>
        <property name="jpaVendorAdapter">
            <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
                <property name="showSql" value="false" />
            </bean>  
        </property>
    </bean>
    -->
    
    

    

   <!-- beans mios -->    
   <!-- TODO ver singletons, esta clase tiene que ser singleton o no? ver de cerrar recursos, ver destroy-method --> 
   <!--M
   <bean id="persistManager" class="uy.gub.fnr.abm.tx.PersistManager">
   </bean>
   
   <bean id="cfconfigApp" class="uy.gub.fnr.abm.conf.ConfigApp">
       <constructor-arg name="packageControllerEnt">
            <list>
                <value>uy.gub.fnr.abm.mvc.impl</value>
            </list>
       </constructor-arg>
       

       <constructor-arg name="packageControllerSQL">
            <list>
                <value>uy.gub.fnr.abm.mvc.impl.sql</value>
            </list>           
       </constructor-arg>
       
       <constructor-arg name="tableDb">
            <list>
                <value>public.campogrande</value>
                <value>public.ft_tramite_pet</value>
                <value>public.huge</value>
                <value>public.varias_col</value>
            </list>           
       </constructor-arg>
       
       <constructor-arg name="linkReport" value="http://localhost:8080/Abm/estatico/rep/" />
       
   </bean>

    
   <bean id="bootstrapAbm" class="uy.gub.fnr.abm.util.BootstrapAbm" init-method="init_boot" >
       
       <property name="ds" ref="dsApp" />
       
       <property name="cfg" ref="cfconfigApp" />

   </bean>  --> 
    
    <context:component-scan base-package="uy.des.atfsff.test" />
    
    <!-- SECURITY ************************************************************************* -->
    
    <security:authentication-manager alias="authenticationManager">
        <security:authentication-provider>
          <security:user-service>
            <security:user name="martin" password="password" authorities="ROLE_SPITTER, ROLE_ADMIN" />
            <security:user name="otro" password="password" authorities="ROLE_SPITTER" />
          </security:user-service>
        </security:authentication-provider>
    </security:authentication-manager>    
    
    <security:http auto-config="true" use-expressions="true" disable-url-rewriting="true" create-session='never'>
        <!-- config for SSL -->
        <!-- <security:port-mappings>
            <security:port-mapping http="8888" https="8181"/>
        </security:port-mappings>        -->
        <!-- for SSL put: requires-channel="https" in security:intercept-url elements-->
        <security:intercept-url pattern="/admin/**" access="hasRole('ROLE_ADMIN') and hasIpAddress('127.0.0.1')"   />
        <security:intercept-url pattern="/login" access="permitAll"  />
        <security:intercept-url pattern="/home" access="isAuthenticated()" />
        <security:intercept-url pattern="/**" access="hasRole('ROLE_SPITTER')" />
        
        <security:form-login login-processing-url="/static/j_spring_security_check"
                    login-page="/login"
                    authentication-failure-url="/login?login_error=t" />
                    
        <security:logout logout-url="/static/j_spring_security_logout" delete-cookies="JSESSIONID"/>
    </security:http>    
    
    <security:global-method-security secured-annotations="enabled" />


</beans>
